version: 1

deploy:
  steps:
    terraformApply:
      after:
        - pip3 install --user ansible
    terraformOutput:
      after:
        - export PATH=$PATH:$(python3 -m site --user-base)/bin
        - terraform output -raw public_ip_website >> inventory
        - ansible-playbook -i inventory --private-key ${key} --ssh-common-args='-F .ssh/config' configure.yml